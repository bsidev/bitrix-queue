(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{HyLJ:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-dashboard"},[a("div",{staticClass:"c-dashboard__panel"},[a("app-time-picker",{on:{change:t.handleTimePresetChange},model:{value:t.timePreset,callback:function(e){t.timePreset=e},expression:"timePreset"}}),t._v(" "),a("app-refresh-picker",{attrs:{title:t.$t("tooltip.autoUpdate")},model:{value:t.refresh,callback:function(e){t.refresh=e},expression:"refresh"}})],1),t._v(" "),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("title.status")}},[t.init?a("stat-panel",{attrs:{type:t.hasConsumers?"success":"danger",title:t.hasConsumers?"":t.$t("tooltip.notFoundConsumers")}},[t._v("\n                    "+t._s(t.hasConsumers?t.$t("label.ok"):t.$t("label.problem"))+"\n                ")]):a("stat-panel",[t._v("\n                    -\n                ")])],1)],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("title.consumers")}},[a("stat-panel",[t._v("\n                    "+t._s(t.summary.consumers?t.summary.consumers.toLocaleString():0)+"\n                ")])],1)],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("enums.status.sent")}},[a("stat-panel",{attrs:{type:"info"}},[t._v("\n                    "+t._s(t.summary.sent?t.summary.sent.toLocaleString():0)+"\n                ")])],1)],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("enums.status.received")}},[a("stat-panel",{attrs:{type:"warning"}},[t._v("\n                    "+t._s(t.summary.received?t.summary.received.toLocaleString():0)+"\n                ")])],1)],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("enums.status.handled")}},[a("stat-panel",{attrs:{type:"success"}},[t._v("\n                    "+t._s(t.summary.handled?t.summary.handled.toLocaleString():0)+"\n                ")])],1)],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("dashboard-panel",{attrs:{title:t.$t("enums.status.failed")}},[a("stat-panel",{attrs:{type:"danger"}},[t._v("\n                    "+t._s(t.summary.failed?t.summary.failed.toLocaleString():0)+"\n                ")])],1)],1)],1),t._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:t.$t("title.stats")}},[a("chart-panel",{attrs:{series:t.chartSeries,options:t.chartOptions,height:"300px"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:t.$t("title.messages")}},[a("recent-messages-panel",{attrs:{data:t.recentMessages.data,total:t.recentMessages.total,"page-size":t.recentMessages.pageSize},on:{"message-select":t.handleMessageSelect,paginate:t.handleRecentMessagesPaginate}})],1)],1)],1),t._v(" "),t.drawerMessage?a("el-drawer",{attrs:{title:t.drawerMessage.message,visible:t.drawer,"destroy-on-close":"",size:"70%","custom-class":"c-drawer"},on:{"update:visible":function(e){t.drawer=e},closed:t.handleDrawerClosed}},[a("message-details",{attrs:{data:t.drawerMessage}})],1):t._e()],1)};s._withStripped=!0;a("4mDm"),a("2B1R"),a("qePV"),a("07d7"),a("5s+n"),a("PKPk"),a("3bBZ"),a("R5XZ");var r=a("o0o1"),n=a.n(r),i=(a("ls82"),a("yXPU")),l=a.n(i),o={props:{initial:{type:Object,default:function(){return{}}}}},u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-time-picker"},[a("el-dropdown",{on:{command:t.handleCommand}},[a("el-button",{attrs:{type:"default"}},[a("i",{staticClass:"el-icon-time el-icon--left"}),t._v(t._s(t.currentPreset.name)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.enabledPresets,(function(e){return a("el-dropdown-item",{key:e.id,attrs:{command:e.id}},[t._v("\n                "+t._s(e.name)+"\n                "),e.id===t.value?a("i",{staticClass:"el-icon-check el-icon--right"}):t._e()])})),1)],1)],1)};u._withStripped=!0;a("fbCW");var c={props:{value:{type:String,required:!0},presets:{type:Array,default:function(){return[]}}},data:function(){return{allPresets:[{id:"-5 minutes",name:this.$t("enums.datePreset.last5m")},{id:"-15 minutes",name:this.$t("enums.datePreset.last15m")},{id:"-30 minutes",name:this.$t("enums.datePreset.last30m")},{id:"-1 hours",name:this.$t("enums.datePreset.last1h")},{id:"-3 hours",name:this.$t("enums.datePreset.last3h")},{id:"-6 hours",name:this.$t("enums.datePreset.last6h")},{id:"-12 hours",name:this.$t("enums.datePreset.last12h")},{id:"-24 hours",name:this.$t("enums.datePreset.last24h")},{id:"-2 days",name:this.$t("enums.datePreset.last2d")},{id:"-7 days",name:this.$t("enums.datePreset.last7d")},{id:"-30 days",name:this.$t("enums.datePreset.last30d")},{id:"-60 days",name:this.$t("enums.datePreset.last60d")},{id:"-90 days",name:this.$t("enums.datePreset.last90d")},{id:"-6 months",name:this.$t("enums.datePreset.last6M")},{id:"-1 year",name:this.$t("enums.datePreset.last1y")}]}},computed:{currentPreset:function(){var t=this;return this.allPresets.find((function(e){return e.id===t.value}))},enabledPresets:function(){var t=this;return 0===this.presets.length?this.allPresets:this.presets.map((function(e){return t.allPresets.find((function(t){return t.id===e}))}))}},methods:{handleCommand:function(t){this.$emit("input",t),this.$emit("change",t)}}},d=a("KHd+"),h=Object(d.a)(c,u,[],!1,null,null,null);h.options.__file="assets/components/AppTimePicker.vue";var p=h.exports,m=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-refresh-picker"},[e("el-button",{attrs:{type:this.value?"primary":"default"},on:{click:this.handleClick}},[e("i",{staticClass:"el-icon-refresh"})])],1)};m._withStripped=!0;var f={props:{value:{type:Boolean,required:!0}},methods:{handleClick:function(){this.$emit("input",!this.value)}}},_=Object(d.a)(f,m,[],!1,null,null,null);_.options.__file="assets/components/AppRefreshPicker.vue";var v=_.exports,g=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-dashboard-panel"},[e("div",{staticClass:"c-dashboard-panel__header"},[e("div",{staticClass:"c-dashboard-panel__title"},[this._v("\n            "+this._s(this.title)+"\n        ")])]),this._v(" "),e("div",{staticClass:"c-dashboard-panel__content"},[this._t("default",[this._m(0)])],2)])};g._withStripped=!0;var b={props:{title:{type:String,default:""}}},y=Object(d.a)(b,g,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-dashboard-panel__stub"},[e("i",{staticClass:"el-icon-s-data"}),this._v(" "),e("div",[this._v("Нет данных")])])}],!1,null,null,null);y.options.__file="assets/components/DashboardPanel.vue";var w=y.exports,P=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-stat-panel",class:this.type?"c-stat-panel--"+this.type:""},[e("div",{staticClass:"c-stat-panel__value"},[this._t("default")],2)])};P._withStripped=!0;var $={props:{type:{type:String,default:""}}},C=Object(d.a)($,P,[],!1,null,null,null);C.options.__file="assets/components/StatPanel.vue";var S=C.exports,x=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"c-chart-panel"},[e("apexchart",{attrs:{type:"area",options:this.mergedOptions,series:this.series,width:"98%",height:this.height}})],1)};x._withStripped=!0;a("QWBl"),a("J30X"),a("zKZe"),a("tkto"),a("FZtP");var D=a("lSNA"),k=a.n(D),M=a("cDf5"),j=a.n(M),O=a("EyHm"),A=a.n(O),q=a("zkkH"),E={components:{apexchart:A.a},props:{series:{type:Array,required:!0},options:{type:Object,required:!1,default:function(){return{}}},height:{type:String,default:"auto"}},data:function(){return{defaultOptions:{chart:{locales:[q],defaultLocale:"ru",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},tooltip:{shared:!0,x:{format:"dd.MM.yyyy HH:mm:ss"}},stroke:{curve:"straight",width:2},fill:{type:"solid",opacity:.4},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},yaxis:{decimalsInFloat:!1}}}},computed:{mergedOptions:function(){return this.extend(this.defaultOptions,this.options)}},methods:{isObject:function(t){return t&&"object"===j()(t)&&!Array.isArray(t)},extend:function(t,e){var a=this,s=Object.assign({},t);return this.isObject(t)&&this.isObject(e)&&Object.keys(e).forEach((function(r){a.isObject(e[r])&&r in t?s[r]=a.extend(t[r],e[r]):Object.assign(s,k()({},r,e[r]))})),s}}},T=Object(d.a)(E,x,[],!1,null,null,null);T.options.__file="assets/components/ChartPanel.vue";var R=T.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-table-panel"},[a("table",{staticClass:"c-table"},[a("thead",[a("tr",[a("th",{staticStyle:{width:"140px"}},[t._v("\n                    "+t._s(t.$t("label.sent_at"))+"\n                ")]),t._v(" "),a("th",[t._v("\n                    "+t._s(t.$t("label.message"))+"\n                ")]),t._v(" "),a("th",{staticStyle:{width:"140px"}},[t._v("\n                    "+t._s(t.$t("label.status"))+"\n                ")]),t._v(" "),a("th",{staticStyle:{width:"200px"}},[t._v("\n                    "+t._s(t.$t("label.transport_name"))+"\n                ")]),t._v(" "),a("th",[t._v("\n                    "+t._s(t.$t("label.buses"))+"\n                ")])])]),t._v(" "),a("tbody",[t._l(t.data,(function(e,s){return a("tr",{key:s},[a("td",[t._v("\n                    "+t._s(t.formatDate(e.sent_at))+"\n                ")]),t._v(" "),a("td",[a("a",{staticClass:"c-link",on:{click:function(a){return a.preventDefault(),t.handleMessageSelect(e)}}},[t._v("\n                        "+t._s(e.message)+"\n                    ")])]),t._v(" "),a("td",[a("el-tag",{attrs:{type:t.getStatusType(e.status),"disable-transitions":""}},[t._v("\n                        "+t._s(t.$t("enums.status."+e.status))+"\n                    ")])],1),t._v(" "),a("td",[t._v("\n                    "+t._s(e.transport_name)+"\n                ")]),t._v(" "),a("td",[t._v("\n                    "+t._s(Array.isArray(e.buses)?e.buses.join(", "):"")+"\n                ")])])})),t._v(" "),0===t.data.length?a("tr",[a("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"5"}},[t._v("\n                    Нет данных\n                ")])]):t._e()],2)]),t._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"hide-on-single-page":""},on:{"current-change":t.handlePageChange}})],1)};z._withStripped=!0;a("DQNa");var L={props:{data:{type:Array,required:!0},total:{type:Number,required:!0},pageSize:{type:Number,default:10}},methods:{getStatusType:function(t){return"failed"===t?"danger":"received"===t?"warning":"handled"===t?"success":"info"},formatDate:function(t){return new Date(t).toLocaleString()},handleMessageSelect:function(t){this.$emit("message-select",t)},handlePageChange:function(t){this.$emit("paginate",t)}}},I=Object(d.a)(L,z,[],!1,null,null,null);I.options.__file="assets/components/RecentMessagesPanel.vue";var U=I.exports,B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-message-details c-dashboard"},[a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("dashboard-panel",{attrs:{title:t.$t("title.summary")}},[a("div",{staticClass:"c-message-details__summary"},t._l(t.summaryProps,(function(e,s){return a("el-row",{key:s,attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:8}},[t._v("\n                            "+t._s(e.name)+"\n                        ")]),t._v(" "),a("el-col",{attrs:{span:16}},[t._v("\n                            "+t._s(e.value)+"\n                        ")])],1)})),1)])],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("dashboard-panel",{attrs:{title:t.$t("title.data")}},[a("div",{staticClass:"c-message-details__data"},[a("vue-json-pretty",{attrs:{data:t.prettyData}})],1)])],1)],1),t._v(" "),t.data.error?a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24}},[a("dashboard-panel",{attrs:{title:t.$t("title.errors")}},[a("table",{staticClass:"c-table c-table--striped"},[a("tbody",t._l(t.errorRows,(function(e,s){return a("tr",{key:s},[a("td",[t._v("\n                                "+t._s(e)+"\n                            ")])])})),0)])])],1)],1):t._e()],1)};B._withStripped=!0;a("TeQF"),a("oVuX"),a("rB9j"),a("EnZy");var F=a("1Tjy"),H=a.n(F),Z=a("29ZS"),J=a.n(Z),N={components:{VueJsonPretty:H.a,DashboardPanel:w},props:{data:{type:Object,required:!0}},computed:{summaryProps:function(){return[{name:this.$t("label.uuid"),value:this.data.uuid},{name:this.$t("label.transport_name"),value:this.data.transport_name},{name:this.$t("label.buses"),value:Array.isArray(this.data.buses)?this.data.buses.join(", "):null},{name:this.$t("label.sent_at"),value:this.formatDate(this.data.sent_at)},{name:this.$t("label.received_at"),value:this.data.received_at?this.formatDate(this.data.received_at):null},{name:this.$t("label.handled_at"),value:this.data.handled_at?this.formatDate(this.data.handled_at):null},{name:this.$t("label.failed_at"),value:this.data.failed_at?this.formatDate(this.data.failed_at):null}].filter((function(t){return null!==t.value&&void 0!==t.value&&""!==t.value}))},prettyData:function(){return J()(this.data.data)},errorRows:function(){return this.data.error.split(/\r?\n/)}},methods:{formatDate:function(t){return new Date(t).toLocaleString()}}},Q=Object(d.a)(N,B,[],!1,null,null,null);Q.options.__file="assets/components/MessageDetails.vue";var X=Q.exports,K=a("vDqi"),V=a.n(K),W=a("Qyje"),G=a.n(W),Y=a("fQM+"),tt=a.n(Y),et=V.a.create({timeout:3e4});et.interceptors.request.use((function(t){return t.headers["X-Bitrix-Csrf-Token"]=tt.a.bitrix_sessid(),t}),(function(t){return console.error(t),Promise.reject(t)})),et.interceptors.response.use((function(t){var e=t.data;return"object"===j()(e)&&"error"===e.status?Array.isArray(e.errors)&&e.errors.length>0?Promise.reject(new Error(e.errors.map((function(t){return t.message})).join("\n"))):Promise.reject(new Error("Error")):e.data}),(function(t){return console.error(t),Promise.reject(t)}));var at=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof t||0===t.length)throw new TypeError('Invalid argument "endpoint"');return et({url:"/bitrix/services/main/ajax.php",method:"post",params:{action:t},data:G.a.stringify(e,{arrayFormat:"indices"})})},st={components:{AppTimePicker:p,AppRefreshPicker:v,DashboardPanel:w,StatPanel:S,ChartPanel:R,RecentMessagesPanel:U,MessageDetails:X},mixins:[o],data:function(){return{timePreset:"-1 hours",refresh:!1,refreshTimer:null,refreshDelay:1e4,init:!1,summary:{},chartSeries:[],chartOptions:{colors:["#909399","#E6A23C","#67C23A","#F56C6C"]},recentMessages:{data:[],total:0,pageSize:10,page:1},drawer:!1,drawerMessage:null}},computed:{hasConsumers:function(){return this.summary.consumers&&Number(this.summary.consumers)>0}},watch:{refresh:function(t){localStorage["bsi.queue.dashboard.refresh"]=t,this.initAutoUpdate()}},created:function(){var t=this,e=localStorage.getItem("bsi.queue.dashboard.timePreset");e&&(this.timePreset=e),"true"===localStorage.getItem("bsi.queue.dashboard.refresh")&&(this.refresh=!0),this.fetchData().then((function(){t.init=!0}))},beforeDestroy:function(){clearInterval(this.refreshTimer)},methods:{fetchData:function(){return Promise.all([this.fetchSummaryData(),this.fetchChartData(),this.fetchRecentMessagesData()])},fetchSummaryData:function(){var t=this;return l()(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,at("bsi:queue.api.dashboard.summary",{from:t.timePreset,to:"now"});case 2:t.summary=e.sent;case 3:case"end":return e.stop()}}),e)})))()},fetchChartData:function(){var t=this;return l()(n.a.mark((function e(){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,at("bsi:queue.api.dashboard.queryRange",{from:t.timePreset,to:"now"});case 2:a=e.sent,t.chartSeries=a.map((function(e){return{name:t.$t("enums.status.".concat(e.status)),data:e.values.map((function(t){return t[0]*=1e3,t}))}}));case 4:case"end":return e.stop()}}),e)})))()},fetchRecentMessagesData:function(){var t=this;return l()(n.a.mark((function e(){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,at("bsi:queue.api.dashboard.recentMessages",{from:t.timePreset,to:"now",pageSize:t.recentMessages.pageSize,page:t.recentMessages.page});case 2:a=e.sent,t.recentMessages.data=a.data,t.recentMessages.total=a.total;case 5:case"end":return e.stop()}}),e)})))()},initAutoUpdate:function(){!0===this.refresh?this.refreshTimer=setInterval(this.autoUpdate,this.refreshDelay):clearInterval(this.refreshTimer)},autoUpdate:function(){this.fetchData()},handleTimePresetChange:function(t){localStorage["bsi.queue.dashboard.timePreset"]=t,this.fetchData()},handleMessageSelect:function(t){this.drawerMessage=t,this.drawer=!0},handleRecentMessagesPaginate:function(t){this.recentMessages.page=t,this.fetchRecentMessagesData()},handleDrawerClosed:function(){this.drawerMessage=null}}},rt=Object(d.a)(st,s,[],!1,null,null,null);rt.options.__file="assets/views/Dashboard.vue";e.default=rt.exports}}]);